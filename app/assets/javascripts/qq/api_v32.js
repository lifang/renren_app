
window.fusionStartTime=new Date().getTime();!window.fusionInheritFrom&&(function(){var fusion=window.fusion=window.fusion||{};var LIB=fusion.LIB=fusion.LIB||{};LIB.err=function(){window.console&&console.error&&Function.prototype.apply.call(console.error,console,Array.prototype.slice.call(arguments,0));typeof arguments[0]=='string'&&alert(arguments[0]);};LIB.getParam=function(name,src){var re=new RegExp('(?:^|\\?|#|&)'+name+'=([^&]*)(?:$|&|#)','i');var m=re.exec(src||location.href);return m?m[1]:'';};var _eventAttachedElement=[];function _purgeAllEvent(){var el;for(var i=0,len=_eventAttachedElement.length;i<len;i++){el=_eventAttachedElement[i];try{if(el&&el.__FEL){LIB.purgeEvent(el);el.__FEL=null;}}catch(_){}}}LIB.attachEvent=function(el,type,fn,win){if(!el||typeof fn!='function'){return;}if(!el.__FEL){if(_eventAttachedElement.length==0){if(window.addEventListener){window.addEventListener('beforeunload',_purgeAllEvent,false);}else if(window.attachEvent){window.attachEvent('onbeforeunload',_purgeAllEvent);}}_eventAttachedElement.push(el);}var _fel=el.__FEL=el.__FEL||{};var _feid=(_fel[type]=_fel[type]||[null]).length;fn.__FEID=_feid;win=win||window;var cfn=_fel[type][_feid]=function(evt){fn(evt||win.event);};if(el.addEventListener){el.addEventListener(type,cfn,false);}else if(el.attachEvent){el.attachEvent('on'+type,cfn);}};LIB.detachEvent=function(el,type,fn){if(!el||typeof fn!='function'){return;}var _feid=fn.__FEID,_fel=el.__FEL,_tmp,cfn;if(!(_feid&&_fel&&(_tmp=_fel[type])&&(cfn=_tmp[_feid]))){_tmp[_feid]=null;cfn=fn;}if(el.removeEventListener){el.removeEventListener(type,cfn,false);}else if(el.detachEvent){el.detachEvent('on'+type,cfn);}};function _purgeEvent(el,type,eventTypeList){if(!el||!eventTypeList){return;}var cfn;for(var i=1,len=eventTypeList.length;i<len;i++){if(cfn=eventTypeList[i]){if(el.removeEventListener){el.removeEventListener(type,cfn,false);}else if(el.detachEvent){el.detachEvent('on'+type,cfn);}eventTypeList[i]=null;}}}LIB.purgeEvent=function(el,type){var _fel;if(!el||!(_fel=el.__FEL)){return;}if(type){_purgeEvent(el,type,_fel[type]);}else{for(var _type in _fel){!({beforeunload:1,unload:1})[type]&&_purgeEvent(el,type,_fel[_type]);}}};LIB.loadScript=function(path,cb,args){var _head=document.getElementsByTagName('head')[0];var _js=document.createElement('script');var _ie=!!window.ActiveXObject;function __on(){if(!_js||(_ie&&!(_js.readyState=='loaded'||_js.readyState=='complete'))){return;}LIB.purgeEvent(_js,_ie?'readystatechange':'load');!_ie&&LIB.purgeEvent(_js,'error');_js.src='';_head.removeChild(_js);_js=null;typeof cb=='function'&&cb(args);}LIB.attachEvent(_js,_ie?'readystatechange':'load',__on);!_ie&&LIB.attachEvent(_js,'error',__on);_js.charset='utf-8';_js.src=path;_head.appendChild(_js);};LIB.timeBasedRate1=function(){return[280,280,260,260,300,260,230,220,250,290,320,340,340,340,270,190,130,60,40,20,20,30,80,160][new Date().getUTCHours()];};LIB.timeBasedRate2=function(){return[570,560,480,430,490,410,330,300,310,360,420,450,430,400,320,210,240,110,60,40,40,60,160,320][new Date().getUTCHours()];};LIB.timeBasedRate3=function(){return[840,840,740,690,800,680,560,520,560,650,730,790,770,740,590,400,380,180,100,60,60,90,240,480][new Date().getUTCHours()];};LIB.getStatFlag=function(rate){if(!rate||rate<=1){return 1;}if(parseInt(rate)!=rate){var _base=1000,_min=Math.floor(rate);rate=Math.random()*_base>=Math.round(rate*_base)-_min*_base?_min:Math.ceil(rate);}return rate*Math.random()<1?rate:void 0;};var _psIdx=0,_psPool=LIB._psPool={};LIB.pingSender=function(url,t){if(!url){return;}var _id='fusionPingSender_'+_psIdx++;var _img=(_psPool[_id]=new Image());_img.id=_id;_img.onload=_img.onerror=function(){this.onload=this.error=null;delete _psPool[this.id];};setTimeout(function(){_img.src=url;},t||500);};LIB.pv=function(domain,path,rate){domain=domain||'fusion.qq.com';path=path||location.pathname;rate=rate||1;if(rate>1&&Math.random()*rate>=1){return;}var t,d;t=document.cookie.match(/(?:^|;+|\s+)pgv_pvid=([^;]*)/i);if(t&&t.length&&t.length>1){d=t[1];}else{d=(Math.round(Math.random()*2147483647)*(new Date().getUTCMilliseconds()))%10000000000;dm=/(?:^|\.)qq\.com$/.test(location.hostname)?'qq.com':/(?:^|\.)pengyou\.com$/.test(location.hostname)?'pengyou.com':/(?:^|\.)manyou\.com$/.test(location.hostname)?'manyou.com':/(?:^|\.)qzoneapp\.com$/.test(location.hostname)?'qzoneapp.com':/(?:^|\.)qqopenapp\.com$/.test(location.hostname)?'qqopenapp.com':/(?:^|\.)tqapp\.cn$/.test(location.hostname)?'tqapp.cn':location.hostname;document.cookie='pgv_pvid='+d+'; path=/; domain='+dm+'; expires=Sun, 31 Jan 2100 00:00:00 GMT;';}t=['http://pingfore.qq.com/pingd?dm=',domain,'&url=',path,'&rdm=-&rurl=-&pgv_pvid=',d,'&cc=-&ct=-&java=1&lang=-&pf=-&scl=-&scr=-&tt=-&tz=-8&vs=3.3&fysn=',Math.random()];LIB.pingSender(t.join(''));};LIB.timeStat=function(flags,timestamps,rate,permanent){rate=rate||1;if(!permanent&&rate>1&&Math.random()*rate>=1){return;}var _param=['flag1='+flags[0],'flag2='+flags[1],'flag3='+flags[2]];for(var i=1,len=timestamps.length;i<len;i++){_param.push(i+'='+(timestamps[i]?(timestamps[i]-timestamps[0]):0));}_param.push('fysn='+Math.random());LIB.pingSender('http://isdspeed.qq.com/cgi-bin/r.cgi?'+_param.join('&'));};LIB.valueStat=function(statId,type,ret,rate,permanent){rate=rate||1;if(!permanent&&rate>1&&Math.random()*rate>=1){return;}LIB.pingSender(['http://isdspeed.qq.com/cgi-bin/v.cgi?flag1=',statId,'&flag2=',type,'&flag3=',ret,'&1=',rate,'&2=0&fysn=',Math.random()].join(''));};LIB.performanceTimeStat=function(flags,rate,permanent){rate=rate||1;if(!permanent&&rate>1&&Math.random()*rate>=1){return;}setTimeout(function(){var performance=window.performance||window.webkitPerformance||window.msPerformance;if(!performance){return;}var list=[performance.timing.navigationStart,performance.timing.unloadEventStart,performance.timing.unloadEventEnd,performance.timing.redirectStart,performance.timing.redirectEnd,performance.timing.fetchStart,performance.timing.domainLookupStart,performance.timing.domainLookupEnd,performance.timing.connectStart,performance.timing.connectEnd,performance.timing.requestStart,performance.timing.responseStart,performance.timing.responseEnd,performance.timing.domLoading,performance.timing.domInteractive,performance.timing.domContentLoadedEventStart,performance.timing.domContentLoadedEventEnd,performance.timing.domComplete,performance.timing.loadEventStart,performance.timing.loadEventEnd];LIB.timeStat(flags,list,rate,true);},5000);};})();(function(){var fusion=window.fusion=window.fusion||{};var LIB=fusion.LIB=fusion.LIB||{};LIB.warn=function(){window.console&&console.warn&&Function.prototype.apply.call(console.warn,console,Array.prototype.slice.call(arguments,0));};LIB.log=function(){window.console&&console.log&&Function.prototype.apply.call(console.log,console,Array.prototype.slice.call(arguments,0));};LIB.insertStyle=function(rules,doc){doc=doc||document;var _node=doc.createElement('style');_node.type='text/css';doc.getElementsByTagName('head')[0].appendChild(_node);if(_node.styleSheet){_node.styleSheet.cssText=rules;}else{_node.appendChild(doc.createTextNode(rules));}};LIB.getClientWidth=function(doc){var _doc=doc||document,_docEl=_doc.documentElement,_bdy=_doc.body;return LIB.ua.ie?(_docEl.clientWidth||_bdy.clientWidth):(_doc.compatMode!='BackCompat'?_docEl.clientWidth:_bdy.clientWidth);};LIB.getClientHeight=function(doc){var _doc=doc||document,_docEl=_doc.documentElement,_bdy=_doc.body;return LIB.ua.ie?(_docEl.clientHeight||_bdy.clientHeight):(_doc.compatMode!='BackCompat'?_docEl.clientHeight:_bdy.clientHeight);};LIB.getScrollWidth=function(doc){var _doc=doc||document,_docEl=_doc.documentElement,_bdy=_doc.body;return!LIB.ua.ie?Math.min(_docEl.scrollWidth,_bdy.scrollWidth):_bdy.scrollWidth;};LIB.getScrollHeight=function(doc){var _doc=doc||document,_docEl=_doc.documentElement,_bdy=_doc.body;return!LIB.ua.ie?Math.min(_docEl.scrollHeight,_bdy.scrollHeight):_bdy.scrollHeight;};LIB.getScrollLeft=function(doc){var _doc=doc||document,_docEl=_doc.documentElement,_bdy=_doc.body,_win=_doc.defaultView;return _win&&('pageXOffset'in _win)?_win.pageXOffset:(_docEl.scrollLeft||_bdy.scrollLeft);};LIB.getScrollTop=function(doc){var _doc=doc||document,_docEl=_doc.documentElement,_bdy=_doc.body,_win=_doc.defaultView;return _win&&('pageXOffset'in _win)?_win.pageYOffset:(_docEl.scrollTop||_bdy.scrollTop);};LIB.encodeURI=function(str){if(!str){return'';}return(str+'').replace(/\%/g,'%25').replace(/\+/g,'%2B').replace(/ /g,'%20').replace(/\?/g,'%3F').replace(/#/g,'%23').replace(/&/g,'%26').replace(/=/g,'%3D').replace(/"/g,'%22');};LIB.escHTML=function(str){if(!str){return'';}return(str+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\x27/g,'&#039;').replace(/\x22/g,'&quot;');};var _isp=fusion.INFO&&fusion.INFO.isp;LIB.getISP=new Date().getDate()%2==1?function(){if(_isp==void 0){var _m=document.cookie.match(/(?:^|;+|\s+)ptisp=(ctc|cnc|edu|cm|cn|os)(?:\s+|;+|$)/);return _isp=(_m&&(_isp=_m[1])?(_isp+'.'):'');}else{return _isp;}}:function(){return'';};LIB.dispatchStat=function(stat,flag){var _ret={},_t;stat&&(_ret.flag=+flag||+stat.flag||void 0)&&(_ret.stat=LIB.getStatFlag((_t=+stat.rate)?_t:(_t=+stat.multiply)?LIB.timeBasedRate2()/_t:(typeof(_t=stat.fn)=='function')?_t():1));return _ret;};LIB.supportPostMessage=(function(){if(window.postMessage){try{if(window.postMessage.toString().indexOf('[native code]')>=0){return true;}else{LIB.err('浏览器原生的postMessage方法似乎已被覆盖，请不要覆盖该原生方法，否则Fusion API可能无法正常工作！');}}catch(_){return true;}}return false;})();LIB.ua=(function(){var ua={},agent=navigator.userAgent,nv=navigator.appVersion,m;if(window.ActiveXObject){ua.ie=6;(window.XMLHttpRequest||(agent.indexOf('MSIE 7.0')>=0))&&(ua.ie=7);(window.XDomainRequest||(agent.indexOf('Trident/4.0')>=0))&&(ua.ie=8);(agent.indexOf('Trident/5.0')>=0)&&(ua.ie=9);(agent.indexOf('Trident/6.0')>=0)&&(ua.ie=10);}else if(document.getBoxObjectFor||typeof(window.mozInnerScreenX)!='undefined'){m=/(?:Firefox|GranParadiso|Iceweasel|Minefield).(\d+\.\d+)/i.exec(agent);ua.firefox=m?parseFloat(m[1],10):3.3;}else if(!navigator.taintEnabled){m=/AppleWebKit.(\d+\.\d+)/i.exec(agent);ua.webkit=m?parseFloat(m[1],10):(document.evaluate?(document.querySelector?525:420):419);if((m=/Chrome.(\d+\.\d+)/i.exec(agent))||window.chrome){ua.chrome=m?parseFloat(m[1],10):2;}else if((m=/Version.(\d+\.\d+)/i.exec(agent))||window.safariHandler){ua.safari=m?parseFloat(m[1],10):3.3;}}else if(window.opera){ua.opera=parseFloat(window.opera.version(),10);}else{ua.ie=6;}m=/CPU.+?OS (\d+(?:_\d+)?).+?like Mac OS X/i.exec(agent);if(agent.indexOf('iPod')>=0){ua.iPod=m?parseFloat(m[1].replace(/_/g,'.'),10):1;}else if(agent.indexOf('iPhone')>=0){ua.iPhone=m?parseFloat(m[1].replace(/_/g,'.'),10):1;}else if(agent.indexOf('iPad')>=0){ua.iPad=m?parseFloat(m[1].replace(/_/g,'.'),10):1;}else if(agent.indexOf('Macintosh')>=0||agent.indexOf('OS X')>=0){m=/(?:Mac )?OS X (\d+(?:_\d+)?)/i.exec(agent);ua.mac=m?parseFloat(m[1].replace(/_/g,'.'),10):1;}else if(agent.indexOf('Window')>=0){m=/Windows NT (\d+(?:\.\d+)?)/i.exec(agent);ua.windows=m?parseFloat(m[1],10):1;}else if(agent.indexOf('Android')>=0){m=/Android (\d+(?:\.\d+)?)/i.exec(agent);ua.android=m?parseFloat(m[1],10):1;}else if(agent.indexOf('Linux')>=0){ua.linux=1;}return ua;})();LIB.imgPathRe=/^http:\/\/[\w\.\-]+\.((?:qzoneapp\.com)|(?:qqopenapp\.com)|(?:qqopenapp\.com)|(?:tqapp\.cn)|(?:qq\.com)|(?:pengyou\.com)|(?:gtimg\.cn)|(?:manyou\.com))\//i;LIB.customParam=decodeURIComponent(LIB.getParam(window._fusionDialogParam||'fusion_param'))||window._fusionDialogValue;})();(function(){var JSON=fusion.JSON=fusion.JSON||{};var _hash={},_escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,_meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},_cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;function _f(n,r,p){r=r||2;p=p||'0';var _a=[];_a[r]=n;return _a.join(p).slice(-r);}function _c(s){s+='';return s.substr(0,1).toUpperCase()+s.substr(1).toLowerCase();}function _filter(value){var _type=Object.prototype.toString.call(value);if(value===null||value instanceof String||value instanceof Number||value instanceof Boolean||value instanceof Date||({'[object String]':1,'[object Number]':1,'[object Boolean]':1,'[object Date]':1})[_type]){return value;}if(value===void 0){return void 0;}if(value===window){return'[object DOMWindow]';}if(value===document){return'[object HTMLDocument]';}if(!value.constructor){return value&&typeof value.tagName==='string'?'[object HTML'+_c(value.tagName)+'Element]':void 0;}if(!({'[object Object]':1,'[object Array]':1})[_type]){return _type;}if(_hash[value.__FUSION_JSON_HASH]===value){return void 0;}var _r;do{r=Math.round(Math.random()*2147483647);}while(_hash[r]);_hash[value.__FUSION_JSON_HASH=r]=value;return value;}function _quote(str){_escapable.lastIndex=0;return'"'+(_escapable.test(str)?str.replace(_escapable,function(m){var _c=_meta[m];return typeof _c==='string'?_c:('\\u'+_f(m.charCodeAt(0).toString(16),4));}):str)+'"';}function _getStr(value){value=_filter(value);var _type=Object.prototype.toString.call(value);if(value===void 0){return void 0;}else if(value===null||value instanceof Boolean||_type==='[object Boolean]'){return String(value);}else if(value instanceof String||_type==='[object String]'){return _quote(value);}else if(value instanceof Number||_type==='[object Number]'){return isFinite(value)?String(value):'null';}else if(value instanceof Date||_type==='[object Date]'){return isFinite(value.valueOf())?_quote(value.getUTCFullYear()+'-'+_f(value.getUTCMonth()+1)+'-'+_f(value.getUTCDate())+'T'+_f(value.getUTCHours())+':'+_f(value.getUTCMinutes())+':'+_f(value.getUTCSeconds())+'.'+_f(value.getUTCMilliseconds(),3)+'Z'):'null';}else if(value instanceof Array||_type==='[object Array]'){var _a=[];for(var i=0,l=value.length;i<l;i++){_a[i]=_getStr(value[i])||'null';}delete _hash[value.__FUSION_JSON_HASH];delete value.__FUSION_JSON_HASH;return'['+_a.join(',')+']';}else if(!value){return'null';}else{var _v,_a=[],_hop=Object.hasOwnProperty;for(var k in value){if(k!='__FUSION_JSON_HASH'&&_hop.call(value,k)&&(_v=_getStr(value[k]))){_a.push(_quote(k)+':'+_v);}}delete _hash[value.__FUSION_JSON_HASH];delete value.__FUSION_JSON_HASH;return'{'+_a.join(',')+'}';}}JSON.stringify=function(value){var _r=_getStr(value);return _r;};JSON.parse=function(text){text=String(text);if(text){_cx.lastIndex=0;if(_cx.test(text)){text=text.replace(_cx,function(a){return'\\u'+_f(a.charCodeAt(0).toString(16),4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){return new Function('return '+text)();}}throw new SyntaxError('JSON.parse');};}());(function(){var Observer=fusion.LIB.Observer=function(sender){this._sender=sender;this._subscriber=[];};Observer.prototype.subscribe=function(fn,self,context){if(typeof fn!=='function'){return false;}var _evt=this._subscriber;for(var i=0,one;one=_evt[i];i++){if(one.fn==fn){return false;}}_evt.push({fn:fn,self:self,context:context});return true;};Observer.prototype.unsubscribe=function(fn){if(typeof fn!=='function'){return false;}var _evt=this._subscriber,_found=false;for(var i=0,one;one=_evt[i];i++){if(one.fn==fn){_found=true;_evt=_evt.slice(0,i).concat(_evt.slice(i+1));break;}}if(!_found){return false;}this._subscriber=_evt;return true;};Observer.prototype.notify=function(args){var _evt=this._subscriber;for(var i=0,one;one=_evt[i];i++){one.fn.call(one.self,args,this._sender,one.context);}};})();(function(){var LIB=fusion.LIB,JSON=fusion.JSON;if(/(?:^|\.)qq\.com$/.test(location.hostname)){document.domain!='qq.com'&&(document.domain='qq.com');}else if(/(?:^|\.)pengyou\.com$/.test(location.hostname)){document.domain!='pengyou.com'&&(document.domain='pengyou.com');}else if(/(?:^|\.)manyou\.com$/.test(location.hostname)){document.domain!='manyou.com'&&(document.domain='manyou.com');}var ORIGIN_DOMAIN_REGEXP=/^https?\:\/\/([^\:\/]+)(?:\:\d+)?/,_map={};var XS=LIB.XStream=function(port,origin,handler,target){var _timestamp=new Date().getTime(),_ins;if(_ins=_map[port]){return _ins;}_map[port]=this;this.port=port;this.origin=origin;this.handler=handler;this.target=target;this.sameDomain=false;try{target.document&&document.domain==target.document.domain&&(this.sameDomain=true);}catch(_){}this.onInit=new LIB.Observer(this);this._isClient=!!target;if(!this.sameDomain&&!LIB.supportPostMessage){var _level=1;if(this._isClient){var _parent=parent;do{if(_parent==target){break;}_parent=_parent.parent;_level++;}while(_parent!=top);this.target=window;}var _PROXY_VERSION=9;var _domain=ORIGIN_DOMAIN_REGEXP.exec(origin);_domain=_domain?_domain[1]:origin;_domain=(/(?:^|\.)qq\.com(?:\:\d+)?$/.test(_domain)?(LIB.getISP()+'qzs.qq.com'):/(?:^|\.)pengyou\.com(?:\:\d+)?$/.test(_domain)?'qzs.pengyou.com':/(?:^|\.)manyou\.com(?:\:\d+)?$/.test(_domain)?'static.manyou.com':_domain);this.proxyUrl=['http://',_domain,'/cross_origin.htm?max_age=31104000#v=',_PROXY_VERSION,'&level=',_level].join('');}this._initialled=false;this._pool=[];this._timer=null;if(this._isClient){var _self=this;var _stat=this.sameDomain?void 0:LIB.getStatFlag(LIB.timeBasedRate3());setTimeout(function(){_self._sendRaw({port:_self.port,stat:_stat,timestamp:[_timestamp,new Date().getTime()],type:'init-server'},true);_stat&&LIB.valueStat(LIB.supportPostMessage?360036:360037,2,11,_stat,true);},0);}};XS.prototype.send=function(data){data&&this._pool.push(data);if(!this._initialled||this._timer||!this._pool.length){return;}this._sendPool();};XS.prototype.dispose=function(){delete _map[this.port];};XS.prototype._sendPool=function(){var _self=this;var _stat=this.sameDomain?void 0:LIB.getStatFlag(LIB.timeBasedRate3()*10);this._timer=setTimeout(function(){_self._timer=null;_self._sendRaw({port:_self.port,stat:_stat,timestamp:new Date().getTime(),data:_self._pool});_self._pool=[];_stat&&LIB.valueStat(LIB.supportPostMessage?360034:360035,2,11,_stat,true);},0);};XS.prototype._sendRaw=function(data,keep){if(this.sameDomain){this.target.fusion.LIB.XStream.dispatch(data,window);return;}var _data=JSON.stringify(data);LIB.log('XStream sent from ['+location.protocol+'//'+location.host+'] to ['+this.origin+']: '+_data,data);if(LIB.supportPostMessage){this.target.postMessage(_data,this.origin);}else if(this.target){var _doc=this.target.document,_frame;_data=encodeURIComponent(_data);try{_frame=_doc.createElement('<iframe name="'+_data+'">');}catch(_){_frame=_doc.createElement('iframe');_frame.name=_data;}_frame.style.cssText='width:1px;height:1px;position:absolute;top:-100px;left:-100px;';_frame.src=this.proxyUrl;_doc.documentElement.insertBefore(_frame,_doc.documentElement.firstChild);!keep&&LIB.attachEvent(_frame,'load',function(){LIB.purgeEvent(_frame,'load');_doc.documentElement.removeChild(_frame);});}};XS.prototype._initComplete=function(){if(this._initialled||this._timer){return;}this._initialled=true;this.onInit.notify();if(!this._pool.length){return;}this._sendPool();};XS.prototype._handle=function(data,target){var _timestamp=new Date().getTime(),_stat=data.stat;LIB.log('XStream received in '+(_timestamp-(data.timestamp[0]||data.timestamp))+' ms');if(data.type=='init-server'){if(target){this.target=target;try{target.fusion&&target.document&&document.domain==target.document.domain&&(this.sameDomain=true);}catch(_){}}this._initComplete();var _self=this;setTimeout(function(){_self._sendRaw({port:_self.port,stat:_stat,timestamp:data.timestamp.concat(_timestamp),type:'init-client'});_stat&&LIB.valueStat(LIB.supportPostMessage?360036:360037,2,12,_stat,true);},0);}else if(data.type=='init-client'){!this.sameDomain&&LIB.timeStat([7721,114,LIB.supportPostMessage?3:4],data.timestamp.concat(_timestamp),LIB.timeBasedRate3());this._initComplete();_stat&&LIB.valueStat(LIB.supportPostMessage?360036:360037,1,13,_stat,true);}else if(this.handler){!this.sameDomain&&LIB.timeStat([7721,114,LIB.supportPostMessage?1:2],[data.timestamp,_timestamp],LIB.timeBasedRate3()*10);for(var i=0,one;one=data.data[i];i++){this.handler.call(this,one,data.port);}_stat&&LIB.valueStat(LIB.supportPostMessage?360034:360035,1,12,_stat,true);}};XS.dispatch=function(data,target){var _port=data.port,_ins;if(!(_ins=_map[_port])){return;}_ins._handle(data,target);};XS.dispatchStr=function(data,target){XS.dispatch(JSON.parse(data),target);};XS.getOrigin=function(href){var _m=ORIGIN_DOMAIN_REGEXP.exec(href);return _m?_m[0]:href;};if(LIB.supportPostMessage){LIB.attachEvent(window,'message',function(evt){XS.dispatchStr(evt.data,evt.source);});}})();(function(){var LIB=fusion.LIB;var _timer=null;var CANVAS=LIB.canvas=LIB.canvas||{};var DOM=CANVAS.dom=CANVAS.dom||[];var POS=CANVAS.pos=CANVAS.pos||[];CANVAS.hasTopProperty=false;CANVAS.onPropertyChanged=new LIB.Observer();function _delaySendProperty(){_timer&&clearTimeout(_timer);_timer=setTimeout(function(){_timer=null;CANVAS.onPropertyChanged.notify();},100);}function _handleEvt(idx){var _pos=POS[idx]={cw:LIB.getClientWidth(DOM[idx].win.document),ch:LIB.getClientHeight(DOM[idx].win.document)};var _frame,_rect;if(idx>0&&(_frame=DOM[idx].frame)){_rect=_frame.getBoundingClientRect();_pos.l=_rect.left;_pos.t=_rect.top;_pos.r=_rect.right;_pos.b=_rect.bottom;}_delaySendProperty();}CANVAS.init=function(baseWin){var _flag,_one,_idx=0,_target,_win=baseWin||window,_frames,_len;try{while(_win){_flag=false;try{document.domain==_win.document.domain&&(_flag=true);}catch(_){}DOM[_idx]=_one={win:_win};if(_flag){LIB.attachEvent(_win,'scroll',(function(idx){return idx==0?_delaySendProperty:function(){_handleEvt(idx);}})(_idx),_win);if(_win==top){CANVAS.hasTopProperty=true;LIB.attachEvent(_win,'resize',(function(idx){return idx==0?_delaySendProperty:function(){_handleEvt(idx);}})(_idx),_win);}if(_idx>0&&(_target=DOM[_idx-1])){_frames=_win.document.getElementsByTagName('iframe');_len=_frames.length;for(var i=0;i<_len;i++){if(_frames[i].contentWindow==_target.win){_one.frame=_frames[i];break;}}_handleEvt(_idx);}}if(_win==top){break;}_idx++;_win=_win.parent;}}catch(_){}_delaySendProperty();};CANVAS.updatePos=function(args){var _pos=args.pos;for(var i=1,l=_pos.length;i<l;i++){_pos[i]&&(POS[i]=_pos[i]);}CANVAS.hasTopProperty=CANVAS.hasTopProperty||args.hasTopProperty;_delaySendProperty();};})();(function(){var LIB=fusion.LIB;var INFO=fusion.INFO=fusion.INFO||{};INFO.appid=+LIB.getParam('appid');INFO.platform=LIB.getParam('platform');var _plugin={};var _stream=new LIB.XStream('api',decodeURIComponent(LIB.getParam('origin')),function(args){var _key=args.key,_args=args.args||{},_stat=args.stat,_p=_plugin[_key];if(typeof _p=='function'){_p(_args);}else if(_p){_p.stat&&(_flag=_p.stat.flag);_p.method&&_p.method(_args);}_stat&&_flag&&LIB.valueStat(_flag,1,_p.stat.ret||99,_stat,true);},parent);fusion.sameDomain=_stream.sameDomain;fusion.call=function(key,args){var _p=_plugin[key],_stat={};args=args||{};if(typeof _p=='function'){_p(args);}else if(_p){_stat=LIB.dispatchStat(_p.stat);_p.method&&_p.method(args);}_stream.send({key:key,args:args,stat:_stat.stat});_stat.stat&&LIB.valueStat(_stat.flag,2,_p.stat.ret||98,_stat.stat,true);};fusion.addPlugin=function(opt){var _p;for(var key in opt){_p=_plugin[key]=opt[key];typeof _p.init=='function'&&setTimeout(_p.init,0);}};setTimeout(function(){var _timestamp=LIB.getParam('timestamp').split(',').concat([window._startTime,window.fusionStartTime,new Date().getTime()]),_stat=+LIB.getParam('stat');LIB.timeStat([7721,113,_stream.sameDomain?3:LIB.supportPostMessage?4:5],_timestamp,LIB.timeBasedRate1()/(_stream.sameDomain?2:5));_stat&&LIB.valueStat(360032,1,12,_stat,true);LIB.pv(null,['/api.htm',INFO.platform,INFO.appid,_stream.origin].join('/'),10);LIB.performanceTimeStat([7721,113,LIB.ua.ie?1:2],LIB.timeBasedRate1()/20);},1000);})();fusion.parent=(function(){var _parent=parent;while(true){try{if(_parent.document.domain==document.domain){return _parent;}}catch(_){}if(_parent==top){return window;}_parent=_parent.parent;}})();fusion.searchChain=function(callback,inner,outer,reverse){inner=inner||fusion.parent||window;outer=outer||top;var _cur=inner,flag,cnt=0,_pool=[];while(true){flag=false;try{_cur.document.domain==document.domain&&(flag=true);}catch(_){}if(flag){if(reverse){_pool.push(_cur);}else if(callback(_cur)===true){return _cur;}}if(_cur==outer||_cur==top){if(reverse){break;}else{return null;}}_cur=_cur.parent;}if(reverse){while(_pool.length){if(callback(_cur=_pool.pop())===true){return _cur;}}return null;}};(function(){var LIB=fusion.LIB,INFO=fusion.INFO;function _run(impl){if(!impl[INFO.platform]){return;}if(!fusion.searchChain(function(win){var _platCheck={qzone:/\.qzone\.qq\.com$/,pengyou:/apps\.pengyou\.com$/,pyqq:/apps\.pengyou\.qq\.com$/,weibo:/(?:app|appsupport)\.t\.qq\.com$/};if(_platCheck[INFO.platform].test(win.location.hostname)){if(impl[INFO.platform](win)!==false){return true;}}})){impl[INFO.platform]();}}function _insertStyle(doc){var _SPRITE_VERSION=3;var _rules=[],_fontFamily='Tahoma';if(LIB.ua.mac){_fontFamily='"Helvetica Neue",Helvetica,"Hiragino Sans GB",Arial,sans-serif';}else if(LIB.ua.windows>=6){_fontFamily='"Microsoft Yahei",Tohama';}_rules.push(".fusion_dialog_wrap{position:absolute;z-index:5000;border:1px solid #535658;background-color:#FFF;font-size:12px;font-family:",_fontFamily,";}");_rules.push(".fusion_dialog_header{height:28px;border-bottom:1px solid #d8d8d8;background:#fafafa;background:-moz-linear-gradient(top,#fafafa 0%,#ededed 100%);background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,#fafafa),color-stop(100%,#ededed));background:-webkit-linear-gradient(top,#fafafa 0%,#ededed 100%);background:-o-linear-gradient(top,#fafafa 0%,#ededed 100%);background:-ms-linear-gradient(top,#fafafa 0%,#ededed 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fafafa',endColorstr='#ededed',GradientType=0);background:linear-gradient(top,#fafafa 0%,#ededed 100%);}");_rules.push(".fusion_dialog_header h3{float:left;height:28px;color:#4c4c4c;font-size:13px;line-height:28px;overflow:hidden;margin:0;padding-left:10px;font-weight:bold;}");_rules.push(".fusion_dialog_header button{background-color:transparent;background-image:url('http://",LIB.getISP(),"qzonestyle.gtimg.cn/open/fusion/img/sprite.png?max_age=31104000&v=",_SPRITE_VERSION,"');background-repeat:no-repeat;background-position:10px 10px;float:right;width:29px;height:28px;margin-right:5px;line-height:100px;border:0 none;cursor:pointer;font-size:0;}");_rules.push(".fusion_dialog_header button:hover{background-position:-11px 10px;}");_rules.push(".fusion_dialog_content{color:#5f5f5f;background-color:#FFF;}");LIB.insertStyle(_rules.join(''),doc);}function _toggleScroll(doc,enabled){var sp,ds=doc.documentElement.style;LIB.ua.firefox&&LIB.ua.firefox>=3.6&&(sp=LIB.getScrollTop(doc));if(!enabled){ds.paddingRight='17px';ds.overflow='hidden';}else{ds.paddingRight=ds.overflow='';}sp&&(doc[doc.compatMode=='CSS1Compat'?'documentElement':'body'].scrollTop=sp);}function _showFullWindow(args,win){var _env=win.fusionEnv=win.fusionEnv||{},_doc=win.document;if(!_env.dialogStyleInserted){_env.dialogStyleInserted=true;_insertStyle(_doc);}var _w=args.width,_h=args.height,_dock=!_w||!_h;_dock&&_toggleScroll(_doc);var _body=_doc.createElement('div');_body.className='fusion_dialog_wrap';var _header=_doc.createElement('div');_header.className='fusion_dialog_header';_body.appendChild(_header);var _title=_doc.createElement('h3');_title.innerHTML=LIB.escHTML(args.title||'');_header.appendChild(_title);var _closeButton=_doc.createElement('button');_closeButton.title='关闭';_header.appendChild(_closeButton);var _content=_doc.createElement('div');_content.className='fusion_dialog_content';var _iframe=_doc.createElement('iframe');_iframe.width='100%';_iframe.height='100%';_iframe.frameBorder='no';_iframe.scrolling=_dock?'auto':'no';_iframe.src=args.url;_content.appendChild(_iframe);_body.appendChild(_content);function _setPos(){_body.style.width=(_dock?(LIB.getClientWidth(_doc)-2):_w)+'px';_content.style.height=(_dock?(LIB.getClientHeight(_doc)-31):_h)+'px';_body.style.left=Math.round((_dock?0:(LIB.getClientWidth(_doc)-_w-2)/2)+LIB.getScrollLeft(_doc))+'px';_body.style.top=Math.round((_dock?0:Math.max(0,(LIB.getClientHeight(_doc)-_h-31)/2))+LIB.getScrollTop(_doc))+'px';}_setPos();_doc.body.appendChild(_body);_dock&&LIB.attachEvent(win,'resize',_setPos,win);function _close(){_iframe.src='about:blank';_content.innerHTML='';LIB.purgeEvent(_closeButton,'click');LIB.purgeEvent(window,'beforeunload');_dock&&LIB.purgeEvent(win,'resize');_doc.body.removeChild(_body);_dock&&_toggleScroll(_doc,true);fusion.call('control.onFullWindowClose',{_idx:args._idx});}LIB.attachEvent(_closeButton,'click',_close,win);LIB.attachEvent(window,'beforeunload',_close);fusion.call('control.onFullWindowLoad',{_idx:args._idx});}fusion.addPlugin({'nav.toApp':function(args){_run({qzone:function(win){var _f;if(win&&win.QZONE&&win.QZONE.FP&&(_f=win.QZONE.FP.toApp)){_f('/myhome/'+args.appid);}else{(win||top).location.href='http://rc.qzone.qq.com/myhome/'+args.appid;}},pengyou:function(win){(win||top).location.href='http://apps.pengyou.com/'+args.appid;},pyqq:function(win){(win||top).location.href='http://apps.pengyou.qq.com/'+args.appid;},weibo:function(win){if(win&&win.location.hostname=='appsupport.t.qq.com'){return false;}(win||top).location.href='http://app.t.qq.com/app/play/'+args.appid;}});},'nav.toHome':function(args){_run({qzone:function(win){var _f;if(win&&win.QZONE&&win.QZONE.FP&&(_f=win.QZONE.FP.toApp)){_f('/myhome');}else{(win||top).location.href='http://rc.qzone.qq.com/myhome/';}},pengyou:function(win){(win||top).location.href='http://home.pengyou.com/';},pyqq:function(win){(win||top).location.href='http://home.pengyou.qq.com/';},weibo:function(win){if(win&&win.location.hostname=='appsupport.t.qq.com'){return false;}(win||top).location.href='http://t.qq.com/';}});},'nav.toFriendHome':function(args){_run({qzone:function(win){(win||top).location.href=(/^[0-9A-F]{32}$/.test(args.openid)?('http://fusion.qq.com/cgi-bin/qzapps/userapp_redirect.cgi?appid='+INFO.appid+'&openid='):'http://user.qzone.qq.com/')+args.openid;},pengyou:function(win){(win||top).location.href=(/^[0-9A-F]{32}$/.test(args.openid)?('http://fusion.pengyou.com/cgi-bin/xyapps/xy_third_jump_HomePage.cgi?appid='+INFO.appid+'&openid='):'http://profile.pengyou.com/index.php?mod=profile&u=')+args.openid;},pyqq:function(win){(win||top).location.href=(/^[0-9A-F]{32}$/.test(args.openid)?('http://fusion.qq.com/cgi-bin/xyapps/xy_third_jump_HomePage.cgi?appid='+INFO.appid+'&openid='):'http://profile.pengyou.qq.com/index.php?mod=profile&u=')+args.openid;}});},'canvas.updatePos':{stat:{flag:350088,ret:11,fn:function(){return LIB.timeBasedRate1()*10;}},init:function(){if(!fusion.sameDomain){var CANVAS=fusion.LIB.canvas;CANVAS.onPropertyChanged.subscribe(function(){fusion.call('canvas.updatePos',{hasTopProperty:CANVAS.hasTopProperty,pos:CANVAS.pos});});CANVAS.init(parent);}}},'canvas.setHeight':{stat:{flag:350086},method:function(args){var _impl={qzone:function(win){var _f;if(win&&win.QZONE&&win.QZONE.appNavEngine&&(_f=win.QZONE.appNavEngine.setAppFrameHeight)){_f(args.height);}}};_impl.weibo=_impl.pyqq=_impl.pengyou=function(win){var _f;if(win&&win.$&&(_f=win.$('app_frame'))){_f.style.height=args.height+'px';_f.height=args.height;}};_run(_impl);}},'control.showFullWindow':{stat:{flag:350087},method:function(args){if(window._Callback){return;}window._Callback=function(ret){window._Callback=void 0;try{delete window._Callback;}catch(_){window._Callback=void 0;}if(ret.ret!=0){fusion.call('control.onFullWindowError',{_idx:args._idx,ret:ret.ret,msg:ret.msg});return;}fusion.searchChain(function(win){if(win==window){return;}_showFullWindow(args,win);return true;},null,null,true);};LIB.loadScript(['http://fusion.qq.com/cgi-bin/appstage/app_bigwindow_check.cgi?appid=',INFO.appid,'&layer_url=',encodeURIComponent(args.url),'&pfid=',({qzone:2,pengyou:3,pyqq:3,weibo:2})[INFO.platform]].join(''));}},'control.onFullWindowLoad':{stat:{flag:350087,ret:51,multiply:60}},'control.onFullWindowError':{stat:{flag:350087,ret:53}},'control.onFullWindowClose':{stat:{flag:350087,ret:55,multiply:60}},'fcm.showConfirm':{stat:{flag:350088,ret:21}},'fcm.updateRate':{stat:{flag:350088,ret:23}}});})();/*  |xGv00|cfea5b39343436becd79283e23c2bd46 */